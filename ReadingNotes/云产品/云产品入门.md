# 云产品入门

<!-- TOC -->

- [云产品入门](#云产品入门)
  - [内容分发网络 CDN](#内容分发网络-cdn)
  - [移动域名解析 HTTPDNS](#移动域名解析-httpdns)
  - [DDoS防护服务 ADAS](#ddos防护服务-adas)

<!-- /TOC -->

---

已整理的云产品列表

<table>
    <tr>
        <td><b>产品分类</b></td> 
        <td><b>产品名</b></td> 
        <td><b>熟悉程度</b></td>
   </tr>
    <!--tr>
        <td rowspan="2">计算</td>    
        <td>云服务器BCC</td>    
    </tr>
    <tr>
        <td>专属服务器DCC</td>    
    </tr-->
    <tr>
        <td>存储和CDN</td>    
        <td>内容分发网络 CDN</td>  
        <td>试用</td>
    </tr>
    <tr>
        <td>域名与网站</td>    
        <td>移动域名解析 HTTPDNS</td>  
        <td>试用</td>  
    </tr>
    <tr>
        <td>安全</td>    
        <td>DDoS防护服务 ADAS</td>
        <td>熟悉</td>    
    </tr>
</table>

---

## 内容分发网络 CDN

将网站的静态资源缓存到各地的边缘节点，用户就近获取缓存资源，又快，又无需向真实服务器发起请求。可以设置缓存策略、回源地址。

优势：
1. 提速，就近访问
2. 减少服务器压力，没有缓存的才向服务器发起请求
3. 缓存策略更新快（测试时1s左右）
4. 控制面板的流量统计分析较丰富
5. 支持HTTPDNS

局限性：
1. 如果资源更新，缓存会和源站不一致。控制台可以强刷URL，服务器不可强刷；缓存和源站可能不一致，各边缘节点的内容也可能不一致

使用建议：
1. 尽量不要通过覆盖来更新文件，而是使用不同的文件名。因为除了CDN外，运营商、路由、代理、浏览器，都有可能自行设置缓存规则。源站原文件更新后，后续的刷新过程完全未知，无法控制。
2. 经常覆盖更新的文件不要开启CDN缓存。

---

## 移动域名解析 HTTPDNS

使用HTTP或HTTPS进行DNS解析，避免被劫持。

HTTPDNS并非向厂商提供的DNS代理/缓存进行查询，而是需要自行配置需解析的DNS记录，能够查询并且只能查询这些。可以手动指定A记录、CNAME记录，也可以直接使用DNS解析结果（PROXY模式）。按查询次数计费，因此有身份验证，并且只能查询配好的几个域名。

优势：
1. 防劫持
2. 更新较快，不需等待DNS各级服务器层层传递

局限性：
1. 没有公开的解析配置更改API，只能手动配置，与其他自动更改IP/CNAME的产品无联动（估计企业用户可定制）
2. 控制台更改解析配置后，疑似没有强制刷新机制，在一段时间内（TTL为60则约1min内）查询到的结果时新时旧，应该是各服务节点缓存过期后才陆续刷新


---

## DDoS防护服务 ADAS

TODO: 补图，基础防护原理x1，高防原理x1

用于防护DDoS攻击，可以发现攻击、清洗攻击流量、。分为基础防护（免费）和高防（付费）。

基础防护
* 可识别攻击类型：SYN Flood、ACK Flood、ICMP Flood、UDP Flood等网络层攻击; CC攻击等应用层攻击
* 攻击检测方式：旁路检测
* 攻击检测指标：bps, pps, qps; 可自动配置并智能调整，也可手动配置
* 防护上限：单IP为5G，超过5G可能被封禁，2小时起
* 封禁策略：流量仍进入云机房，但是全部被drop，不能到达服务器

高防
* 可识别攻击类型：SYN Flood、SYN/ACK Flood、FIN/RST Flood、UDP Flood、ICMP Flood等网络层攻击; HTTP GET/POST Flood, CC, HTTP SLOW HEADER/POST, TCP连接耗尽等攻击
* 攻击检测方式：未知，大概率串行检测
* 攻击检测指标：bps, pps, qps等基础指标，以及各种复杂指标
* 防护上限：最高600G（很贵）
* 封禁策略：高防中心IP超出运营商限制后，直接拉黑高防IP，高防IP在网络上消失，高防服务不可用；云厂商拉黑一次高防IP需付给运营商相应费用

局限性：
1. 只有一个高防中心，与CDN、域名动态加速等功能相矛盾，只可取其一
2. 遭受攻击时，正常流量可能会被误拦，有损防护
3. 因流量不能就近处理，并且多一次转发，延迟会有所增加
4. 数据包转发后源IP可能变化
5. DNS切换需要一定的时间，通常为1min左右，因为CNAME的TTL为60，在此期间，服务器EIP仍有可能因为流量过大被拉黑，服务器也有可能因为瞬时负载过大而出现稳定性问题

防护效果/优势：
1. 被攻击时，可以清洗掉攻击流量，业务稳定性不受影响
2. 被攻击时，如果在DNS切换期间，EIP已经因为流量过大被拉黑，流量牵引至高防中心后（需要1min左右），业务即可恢复正常
